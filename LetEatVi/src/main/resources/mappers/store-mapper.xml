<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="store">

	<select id="selectAllProductCount" resultType="_int">
		SELECT COUNT(*)
		FROM PRODUCT
	</select>
	
	<select id="selectProduct" resultType="prod">
		SELECT PID, PNAME, PPRICE, PINFO, CNAME
		FROM PRODUCT P, CATEGORY C
		WHERE P.CID = C.CID
	</select>
	
	<select id="selectOneProduct" parameterType="_int" resultType="prod">
		SELECT PID, PNAME, PPRICE, PINFO, CNAME
		FROM PRODUCT P, CATEGORY C
		WHERE P.CID = C.CID
		AND P.PID = #{pid}
	</select>

	<select id="selectCategory" parameterType="_int" resultType="prod">
		SELECT PID, PNAME, PPRICE, PINFO, CNAME
		FROM PRODUCT P, CATEGORY C
		WHERE P.CID = C.CID
		AND C.CID = #{cid}
	</select>
	
	<select id="selectAllCategory" resultType="prod">
		SELECT PID, PNAME, PPRICE, PINFO, CNAME
		FROM PRODUCT P, CATEGORY C
		WHERE P.CID = C.CID
	</select>
	
	<select id="selectOneMember" parameterType="string" resultType="Member">
		SELECT USERNAME, EMAIL, PHONE
		FROM MEMBER
		WHERE USERID = #{userId}
	</select>
	
 	<insert id="insertPaymentInfo" parameterType="Payment">
		INSERT INTO ORDERLIST VALUES(#{oid}, #{userId} , DEFAULT, #{totalPrice}, #{ocomment}, #{addressee}, #{address}, #{phone})	
	</insert>
	
	<insert id="insertOneCart" parameterType="Cart">
		INSERT INTO CART VALUES(SEQ_CART_ID.NEXTVAL, #{userId}, #{pid}, DEFAULT)
	</insert>
	
	<select id="selectOneCart" parameterType="Cart" resultType="_int">
		SELECT COUNT(*)
		FROM CART
		WHERE USERID = #{userId}
		AND PID = #{pid}
	</select>
	
	<delete id="deleteCart" parameterType="Cart">
		DELETE 
		FROM CART
		WHERE USERID = #{userId}
		AND PID = #{pid}
	</delete>
	
	<insert id="insertOneCartWithQuantity" parameterType="Cart">
		INSERT INTO CART VALUES(SEQ_CART_ID.NEXTVAL, #{userId}, #{pid}, #{cartquantity})
	</insert>

	
	<select id="selectAllCart" parameterType="string" resultType="Cart">
		SELECT * FROM PRODUCT P,
		(   SELECT *
    		FROM CART
    		WHERE USERID = #{userId} ) B
		WHERE P.PID = B.PID
	</select>

</mapper>